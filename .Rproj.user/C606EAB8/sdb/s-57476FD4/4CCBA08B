{
    "collab_server" : "",
    "contents" : "# Draws a lorrelogram when provided three columns,\n# id = patient or cluster ids\n# time = time of measurement\n# y = binary outcome\n#title = title for the plot produced.\n\nlorelogram <- function(id, time, y, title){\n  data <- data_frame(id,time,y)\n\n  #function that innumerates all combinations of a given time\n  #and all futures times for an individual and then\n  #returns a dataframe of time differences and results at both time points\n  calc_time_deltas <- function(ind_data){\n    results <- expand.grid(ind_data$time,ind_data$time) %>%\n      rename(time1 = Var1, time2 = Var2) %>%  #rename columns to meaningful stuff\n      right_join(ind_data[,c(\"time\", \"y\")], by = c(\"time1\" = \"time\")) %>%\n      rename(y1 = y) %>%  #add results for time1 from the full data\n      right_join(ind_data[,c(\"time\", \"y\")], by = c(\"time2\" = \"time\")) %>%\n      rename(y2 = y) %>%  #add results for time2 from the full data.\n      mutate(time_diff = time1 - time2, id = ind_data$id[1]) %>% #find difference in times\n      filter(time_diff > 0) %>%  #only interested in positive times.\n      select(time_diff, y1, y2)  #cleanup output.\n  }\n\n  Z <- data %>%\n    group_by(id) %>% #grab an individuals data in isolation\n    do(calc_time_deltas(.)) #run the immumeration function\n\n  #Predict past outcomes from future by utilizing time differences\n  outcome_model <- glm(y1 ~ y2:factor(time_diff), data=Z, family=binomial)\n\n  #grab the parameter estimates (ignoring intercept)\n  LOR_estimates <- data_frame(\n    time_diff = sort(unique(Z$time_diff)),\n    point_est = summary(outcome_model)$coef[-1,1],\n    std_err = summary(outcome_model)$coef[-1,2] ) %>%\n    mutate(lower_bound = point_est - 1.96*std_err,\n           upper_bound = point_est + 1.96*std_err)\n\n  #plot it\n  ggplot(LOR_estimates, aes(x = time_diff)) +\n    geom_ribbon(aes(ymin = lower_bound, ymax = upper_bound, fill = \"95 % CI\"),\n                alpha = 0.5) +\n    geom_line(aes(y = point_est, color = \"point estimate\")) +\n    scale_colour_manual(\"\",values=\"black\")+\n    scale_fill_manual(\"\",values=\"steelblue\") +\n    labs(x = \"time change\", y = \"Log Odds Ratio\", title = title)\n}\n",
    "created" : 1490894325661.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "977936152",
    "id" : "4CCBA08B",
    "lastKnownWriteTime" : 1490894411,
    "last_content_update" : 1490894411115,
    "path" : "~/research/R_packages/nviz/R/lorelogram.R",
    "project_path" : "R/lorelogram.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}